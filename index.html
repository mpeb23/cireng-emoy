<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aneka Cipta Rasa - Usaha Rumahan Makanan & Kerajinan</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- AOS (Animate On Scroll) CDN -->
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK (For Firestore) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, query, onSnapshot, serverTimestamp, updateDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Log level for debugging
        setLogLevel('debug');

        // Global variables are provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;

        window.db = null;
        window.auth = null;
        window.userId = null;
        window.appId = appId;
        
        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            window.db = db;
            window.auth = auth;

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    // Sign in anonymously if no token is available
                    try {
                        const anonymousUser = await signInAnonymously(auth);
                        userId = anonymousUser.user.uid;
                    } catch (error) {
                        console.error("Error signing in anonymously:", error);
                        // Fallback to random ID if anonymous sign-in fails
                        userId = crypto.randomUUID(); 
                    }
                }
                window.userId = userId;

                // Call the main initialization function after auth is ready
                if (window.initCartAndData) {
                    window.initCartAndData();
                }
            });

            // Use custom token if provided
            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken).catch(error => {
                    console.error("Error signing in with custom token:", error);
                });
            } else if (!auth.currentUser) {
                // If no token and no current user, onAuthStateChanged will handle anonymous sign-in
            }

            // Expose Firestore operations to global scope (if needed by other scripts)
            window.saveContactMessage = async (name, email, message) => {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not logged in.");
                    return;
                }
                try {
                    const messageRef = collection(db, `artifacts/${appId}/users/${userId}/contact_messages`);
                    await setDoc(doc(messageRef), {
                        name: name,
                        email: email,
                        message: message,
                        timestamp: serverTimestamp(),
                        userId: userId,
                    });
                    return true;
                } catch (e) {
                    console.error("Error adding document: ", e);
                    return false;
                }
            };
            
            window.fetchTestimonials = () => {
                if (!db || !userId) {
                    console.warn("Firestore not initialized. Using mock testimonials.");
                    return null; 
                }
                const testimonialsRef = collection(db, `artifacts/${appId}/public/data/testimonials`);
                const q = query(testimonialsRef);
                
                // Return the unsubscribe function for cleanup
                return onSnapshot(q, (querySnapshot) => {
                    const testimonials = [];
                    querySnapshot.forEach((doc) => {
                        testimonials.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Update the DOM with the fetched testimonials
                    if (window.renderTestimonials) {
                        window.renderTestimonials(testimonials);
                    }
                }, (error) => {
                    console.error("Error fetching testimonials: ", error);
                });
            };
            
            window.saveNewTestimonial = async (name, content) => {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not logged in.");
                    return false;
                }
                try {
                    const testimonialsRef = collection(db, `artifacts/${appId}/public/data/testimonials`);
                    await setDoc(doc(testimonialsRef), {
                        name: name,
                        content: content,
                        timestamp: serverTimestamp(),
                        userId: userId,
                    });
                    return true;
                } catch (e) {
                    console.error("Error adding testimonial: ", e);
                    return false;
                }
            };

        } else {
             // Fallback for environment where firebaseConfig is not provided
             console.warn("Firebase configuration not found. Firestore features will be mocked.");
             window.userId = crypto.randomUUID(); // Fallback ID
             if (window.initCartAndData) {
                window.initCartAndData();
            }
        }
    </script>

    <!-- Configure the theme and default font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #fdb97b; /* Warm accent color */
            border-radius: 4px;
        }

        ::-webkit-scrollbar-track {
            background-color: #f7f7f7;
        }

        /* Custom Styles for aesthetic enhancements */
        .card-shadow {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.03);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-shadow:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>

<body class="bg-white text-gray-800 antialiased overflow-x-hidden">

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container space-y-2"></div>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/6281380637870" target="_blank" title="Chat via WhatsApp"
        class="fixed bottom-6 right-6 z-50 p-4 bg-orange-500 hover:bg-orange-600 text-white rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
        data-aos="zoom-in" data-aos-delay="1000">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle">
            <path d="M7.9 20A10 10 0 0 0 17 5v1.4a8 8 0 0 1-8.5 11.2l-3.2 2.6z"/>
            <path d="M12 2a10 10 0 0 0 10 10 10 10 0 0 1-5 8.7L12 22l-1-1.3A10 10 0 0 0 2 12 10 10 0 0 0 12 2z"/>
            <path d="M17 12a.5.5 0 0 0-1 0v1.5a.5.5 0 0 0 1 0V12z"/>
        </svg>
    </a>

    <!-- Sticky Navbar -->
    <nav class="sticky top-0 z-40 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Brand Name -->
                <div class="flex-shrink-0">
                    <button onclick="showView('home')" class="text-2xl font-bold text-green-800 hover:text-orange-500 transition duration-300">Aneka Cipta Rasa</button>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8">
                    <button onclick="showView('home')" class="nav-link text-gray-600 hover:text-orange-500 font-medium transition duration-300">Home</button>
                    <button onclick="showView('products')" class="nav-link text-gray-600 hover:text-orange-500 font-medium transition duration-300">Produk</button>
                    <button onclick="showView('about')" class="nav-link text-gray-600 hover:text-orange-500 font-medium transition duration-300">Tentang</button>
                    <button onclick="showView('contact')" class="nav-link text-gray-600 hover:text-orange-500 font-medium transition duration-300">Kontak</button>
                </div>
                
                <!-- Cart Button (Desktop & Mobile) -->
                <div class="flex items-center">
                    <button onclick="showView('cart')" class="p-2 relative rounded-full text-gray-600 hover:text-orange-500 transition duration-300" aria-label="Keranjang Belanja">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.62h9.72a2 2 0 0 0 2-1.62l.68-3.11A2 2 0 0 0 19.45 8H7.49"/></svg>
                        <span id="cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-orange-500 rounded-full">0</span>
                    </button>
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" type="button" class="md:hidden ml-3 p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500" aria-controls="mobile-menu" aria-expanded="false" onclick="toggleMobileMenu()">
                        <span class="sr-only">Buka menu utama</span>
                        <!-- Icon when menu is closed -->
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <!-- Icon when menu is open -->
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div class="md:hidden" id="mobile-menu" style="display: none;">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col">
                <button onclick="showView('home'); toggleMobileMenu()" class="nav-link text-gray-600 hover:bg-green-50 hover:text-orange-500 block px-3 py-2 rounded-md text-base font-medium transition duration-300 text-left">Home</button>
                <button onclick="showView('products'); toggleMobileMenu()" class="nav-link text-gray-600 hover:bg-green-50 hover:text-orange-500 block px-3 py-2 rounded-md text-base font-medium transition duration-300 text-left">Produk</button>
                <button onclick="showView('about'); toggleMobileMenu()" class="nav-link text-gray-600 hover:bg-green-50 hover:text-orange-500 block px-3 py-2 rounded-md text-base font-medium transition duration-300 text-left">Tentang</button>
                <button onclick="showView('contact'); toggleMobileMenu()" class="nav-link text-gray-600 hover:bg-green-50 hover:text-orange-500 block px-3 py-2 rounded-md text-base font-medium transition duration-300 text-left">Kontak</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area (SPA container) -->
    <main id="main-content">
        <!-- Home View (Active by default) -->
        <section id="view-home" class="view-section pt-10 pb-20">
            <!-- Hero Section -->
            <div class="bg-green-100/50 pt-16 pb-24 border-b border-green-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col lg:flex-row items-center justify-between gap-10">
                    <!-- Text Content -->
                    <div class="lg:w-1/2 text-center lg:text-left" data-aos="fade-right" data-aos-duration="1000">
                        <h1 class="text-5xl md:text-6xl font-extrabold text-green-900 mb-4 leading-tight">
                            Rasa Lokal, Kualitas Global.
                        </h1>
                        <p class="text-xl text-gray-600 mb-8">
                            Aneka Cipta Rasa menghadirkan produk makanan ringan dan kerajinan tangan terbaik dari usaha rumahan lokal. Segar, otentik, dan penuh makna.
                        </p>
                        <button onclick="showView('products')" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg shadow-orange-200 transition duration-300 transform hover:scale-[1.02]">
                            Belanja Sekarang
                        </button>
                    </div>

                    <!-- Image/Illustration -->
                    <div class="lg:w-1/2 mt-10 lg:mt-0" data-aos="fade-left" data-aos-duration="1000">
                        <img src="https://placehold.co/600x400/fff3e0/ff8c00?text=Produk+Lokal+Premium" 
                             alt="Ilustrasi produk makanan dan kerajinan lokal" 
                             class="w-full h-auto object-cover rounded-3xl shadow-xl shadow-green-200">
                    </div>
                </div>
            </div>

            <!-- Features/Value Proposition Section -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
                <h2 class="text-3xl font-bold text-center text-green-800 mb-12" data-aos="fade-up">Mengapa Memilih Produk Kami?</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="text-center p-6 rounded-xl bg-green-50 card-shadow" data-aos="zoom-in" data-aos-delay="100">
                        <div class="text-orange-500 mb-3 mx-auto flex justify-center">
                            <i data-lucide="hand-heart" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Dibuat dengan Hati</h3>
                        <p class="text-gray-600">Setiap produk adalah hasil kerja keras perajin dan pengusaha rumahan lokal.</p>
                    </div>
                    <div class="text-center p-6 rounded-xl bg-green-50 card-shadow" data-aos="zoom-in" data-aos-delay="300">
                        <div class="text-orange-500 mb-3 mx-auto flex justify-center">
                            <i data-lucide="award" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Kualitas Premium</h3>
                        <p class="text-gray-600">Menggunakan bahan baku terbaik dan dijamin kualitasnya.</p>
                    </div>
                    <div class="text-center p-6 rounded-xl bg-green-50 card-shadow" data-aos="zoom-in" data-aos-delay="500">
                        <div class="text-orange-500 mb-3 mx-auto flex justify-center">
                            <i data-lucide="leaf" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Dukungan Lokal</h3>
                        <p class="text-gray-600">Setiap pembelian membantu pertumbuhan ekonomi usaha kecil.</p>
                    </div>
                </div>
            </div>
            
            <!-- Quick Link to Catalog -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-16 text-center" data-aos="fade-up" data-aos-delay="200">
                <h2 class="text-4xl font-extrabold text-green-900 mb-6">Jelajahi Produk Kami</h2>
                <p class="text-xl text-gray-600 mb-8">Lihat koleksi lengkap makanan ringan dan kerajinan yang tersedia.</p>
                <button onclick="showView('products')" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg shadow-green-300 transition duration-300 transform hover:scale-105">
                    Lihat Semua Produk
                </button>
            </div>
        </section>

        <!-- Products View (Catalog) -->
        <section id="view-products" class="view-section hidden pt-20 pb-20 bg-green-50/70">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-green-900 text-center mb-12" data-aos="fade-down">Katalog Produk Unggulan</h2>

                <!-- Search and Filter -->
                <div class="mb-10 flex flex-col md:flex-row gap-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="relative flex-grow">
                        <input type="text" id="product-search" oninput="renderProducts()" placeholder="Cari produk (mis. keripik, batik)..."
                            class="w-full py-3 pl-12 pr-4 border border-green-300 rounded-xl focus:ring-orange-500 focus:border-orange-500 transition duration-200">
                        <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    </div>
                    <select id="category-filter" onchange="renderProducts()"
                        class="py-3 px-4 border border-green-300 rounded-xl focus:ring-orange-500 focus:border-orange-500 transition duration-200 bg-white">
                        <option value="all">Semua Kategori</option>
                        <!-- Options generated by JS -->
                    </select>
                </div>

                <!-- Product Grid -->
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Products will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Product Detail View -->
        <section id="view-detail" class="view-section hidden pt-20 pb-20">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <button onclick="showView('products')" class="text-green-600 hover:text-orange-500 font-medium mb-8 flex items-center transition duration-200">
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i> Kembali ke Katalog
                </button>
                <div id="product-detail-content" class="bg-white p-8 rounded-2xl card-shadow border border-green-100">
                    <!-- Detail content will be injected here by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Cart View -->
        <section id="view-cart" class="view-section hidden pt-20 pb-20 bg-green-50/70">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-green-900 text-center mb-10" data-aos="fade-down">Keranjang Belanja Anda</h2>

                <div id="cart-list" class="space-y-6">
                    <!-- Cart items will be injected here by JavaScript -->
                </div>
                
                <div id="cart-summary" class="mt-10 p-6 bg-white rounded-xl card-shadow border border-green-200" data-aos="fade-up">
                    <div class="flex justify-between items-center text-2xl font-bold mb-4">
                        <span class="text-gray-800">Total Harga:</span>
                        <span id="cart-total" class="text-orange-600">Rp 0</span>
                    </div>
                    
                    <button id="checkout-button" onclick="checkoutViaWhatsApp()" disabled
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-4 rounded-xl shadow-lg shadow-green-300 transition duration-300 transform hover:scale-[1.01] flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="whatsapp" class="w-6 h-6 mr-2 fill-white"></i> Checkout via WhatsApp
                    </button>
                    <p id="empty-cart-message" class="text-center text-gray-500 mt-4 hidden">Keranjang Anda masih kosong. Yuk, segera belanja!</p>
                </div>

                <div class="text-center mt-8">
                    <button onclick="showView('products')" class="text-green-600 hover:text-orange-500 font-medium flex items-center mx-auto transition duration-200">
                        <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i> Lanjutkan Belanja
                    </button>
                </div>
            </div>
        </section>
        
        <!-- About View (Tentang) -->
        <section id="view-about" class="view-section hidden pt-20 pb-20">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-green-900 text-center mb-12" data-aos="fade-down">Tentang Kami</h2>
                
                <div class="space-y-8 text-lg text-gray-700 bg-white p-8 rounded-2xl card-shadow border border-green-100" data-aos="fade-up">
                    <p>Aneka Cipta Rasa lahir dari semangat untuk mengangkat potensi lokal Indonesia. Kami percaya bahwa produk rumahan memiliki kualitas dan cerita yang tidak kalah hebat dari produk pabrikan besar. Kami menjalin kemitraan dengan para perajin dan pengusaha makanan ringan yang gigih, memastikan setiap produk yang sampai di tangan Anda adalah hasil seleksi terbaik.</p>
                    <p class="font-semibold text-green-800">Misi kami sederhana: Menjadi jembatan antara konsumen yang menghargai kualitas dan perajin lokal yang berdedikasi.</p>
                </div>
                
                <!-- Testimonials Section -->
                <div class="mt-16">
                    <h3 class="text-3xl font-bold text-green-800 text-center mb-8" data-aos="fade-up">Kata Pelanggan Kami</h3>
                    <div id="testimonial-carousel" class="relative overflow-hidden bg-green-100 p-8 rounded-2xl card-shadow border border-green-200" data-aos="zoom-in">
                        <div id="testimonial-container" class="flex transition-transform duration-500 ease-in-out">
                            <!-- Testimonials will be injected here -->
                            <div class="w-full flex-shrink-0 text-center p-4">
                                <p class="italic text-gray-700 text-xl mb-4">"Kripik singkongnya nagih banget, renyah dan bumbunya pas. Pengiriman cepat dan packaging rapi!"</p>
                                <p class="font-semibold text-green-800">- Rina, Jakarta</p>
                            </div>
                            <div class="w-full flex-shrink-0 text-center p-4">
                                <p class="italic text-gray-700 text-xl mb-4">"Batik tulisnya sangat cantik, ukiran kayunya juga detail. Produk lokal yang membanggakan!"</p>
                                <p class="font-semibold text-green-800">- Bima, Bandung</p>
                            </div>
                            <div class="w-full flex-shrink-0 text-center p-4">
                                <p class="italic text-gray-700 text-xl mb-4">"Nastar Kejunya premium, cocok untuk hantaran. Selalu repeat order dari sini."</p>
                                <p class="font-semibold text-green-800">- Citra, Surabaya</p>
                            </div>
                        </div>
                        
                        <button onclick="prevTestimonial()" class="absolute left-2 top-1/2 transform -translate-y-1/2 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 transition duration-200 text-green-800">
                            <i data-lucide="chevron-left" class="w-6 h-6"></i>
                        </button>
                        <button onclick="nextTestimonial()" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 transition duration-200 text-green-800">
                            <i data-lucide="chevron-right" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mt-16 p-6 bg-orange-100 rounded-xl border border-orange-200" data-aos="fade-up" data-aos-delay="200">
                     <p class="text-center font-medium text-orange-800">ID Pengguna Anda untuk Kolaborasi Data (Firestore): <span class="font-mono text-sm" id="current-user-id">Memuat...</span></p>
                </div>
                
            </div>
        </section>

        <!-- Contact View (Kontak) -->
        <section id="view-contact" class="view-section hidden pt-20 pb-20 bg-green-50/70">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-green-900 text-center mb-12" data-aos="fade-down">Hubungi Kami</h2>

                <div class="bg-white p-8 rounded-2xl card-shadow border border-green-100 grid grid-cols-1 lg:grid-cols-2 gap-10">
                    <!-- Contact Information -->
                    <div class="space-y-6" data-aos="fade-right">
                        <div class="flex items-start space-x-4">
                            <i data-lucide="map-pin" class="w-6 h-6 text-orange-500 flex-shrink-0 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-gray-800">Alamat Kami</h4>
                                <p class="text-gray-600">Jl. Cipta Rasa No. 12, Sentra UMKM, Kota Harapan, 17530, Indonesia</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <i data-lucide="clock" class="w-6 h-6 text-orange-500 flex-shrink-0 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-gray-800">Jam Operasional</h4>
                                <p class="text-gray-600">Senin - Sabtu: 09.00 - 17.00 WIB</p>
                                <p class="text-gray-600">Minggu: Tutup (Hanya pengiriman)</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <i data-lucide="mail" class="w-6 h-6 text-orange-500 flex-shrink-0 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-gray-800">Email</h4>
                                <p class="text-gray-600">info@anekaciptarasa.id</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <i data-lucide="phone" class="w-6 h-6 text-orange-500 flex-shrink-0 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-gray-800">Telepon/WhatsApp</h4>
                                <p class="text-gray-600">+62 813-8063-7870</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Form -->
                    <form id="contact-form" class="space-y-4" onsubmit="handleContactSubmit(event)" data-aos="fade-left">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                            <input type="text" id="name" name="name" required
                                class="w-full px-4 py-3 border border-green-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-200">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-4 py-3 border border-green-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-200">
                        </div>
                        <div>
                            <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Pesan</label>
                            <textarea id="message" name="message" rows="4" required
                                class="w-full px-4 py-3 border border-green-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-200"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-xl shadow-md shadow-orange-200 transition duration-300 transform hover:scale-[1.01]">
                            Kirim Pesan
                        </button>
                    </form>
                </div>
                
                <!-- FAQ Section -->
                <div class="mt-16">
                    <h3 class="text-3xl font-bold text-green-800 text-center mb-8" data-aos="fade-up">FAQ (Pertanyaan Umum)</h3>
                    <div id="faq-list" class="space-y-4" data-aos="fade-up" data-aos-delay="200">
                        <!-- FAQ Items (using simple accordion) -->
                        <div class="bg-white p-5 rounded-xl card-shadow border border-green-200">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-lg text-gray-800" onclick="toggleFaq(this)">
                                Bagaimana cara memesan?
                                <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                            </button>
                            <div class="faq-content mt-3 hidden text-gray-600">
                                Anda bisa memesan melalui halaman Produk, masukkan ke Keranjang, lalu selesaikan pemesanan melalui tombol "Checkout via WhatsApp" untuk pesan otomatis. Atau klik tombol WhatsApp di pojok kanan bawah.
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl card-shadow border border-green-200">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-lg text-gray-800" onclick="toggleFaq(this)">
                                Apakah produk dijamin keasliannya?
                                <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                            </button>
                            <div class="faq-content mt-3 hidden text-gray-600">
                                Ya, kami hanya menjual produk asli dari usaha rumahan lokal dengan standar kualitas yang ketat. Semua kerajinan adalah buatan tangan (hand-made).
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl card-shadow border border-green-200">
                            <button class="flex justify-between items-center w-full text-left font-semibold text-lg text-gray-800" onclick="toggleFaq(this)">
                                Berapa lama waktu pengiriman?
                                <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                            </button>
                            <div class="faq-content mt-3 hidden text-gray-600">
                                Waktu pengiriman bervariasi tergantung lokasi Anda. Umumnya 2-5 hari kerja setelah konfirmasi pembayaran. Untuk produk *pre-order* (misal batik tulis), estimasi akan diinfokan terpisah.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white pt-12 pb-8 mt-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Brand Info -->
                <div>
                    <h3 class="text-2xl font-bold text-orange-400 mb-4">Aneka Cipta Rasa</h3>
                    <p class="text-gray-400 text-sm">Menghubungkan Anda dengan cita rasa dan karya terbaik dari pengusaha rumahan lokal.</p>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-green-300">Link Cepat</h4>
                    <ul class="space-y-2 text-sm">
                        <li><button onclick="showView('products')" class="text-gray-400 hover:text-white transition duration-200">Produk Kami</button></li>
                        <li><button onclick="showView('about')" class="text-gray-400 hover:text-white transition duration-200">Tentang Kami</button></li>
                        <li><button onclick="showView('contact')" class="text-gray-400 hover:text-white transition duration-200">Kontak</button></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Kebijakan Privasi</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-green-300">Hubungi Kami</h4>
                    <p class="text-gray-400 text-sm">Alamat: Jl. Cipta Rasa No. 12</p>
                    <p class="text-gray-400 text-sm">WA: +62 813-8063-7870</p>
                    <p class="text-gray-400 text-sm">Email: info@anekaciptarasa.id</p>
                    <p class="text-gray-400 text-sm mt-2">ID Pengguna: <span id="footer-user-id" class="font-mono text-xs">Memuat...</span></p>
                </div>

                <!-- Social Media -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 text-green-300">Media Sosial</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-orange-400 transition duration-200" aria-label="Instagram"><i data-lucide="instagram" class="w-6 h-6"></i></a>
                        <a href="#" class="text-gray-400 hover:text-orange-400 transition duration-200" aria-label="Facebook"><i data-lucide="facebook" class="w-6 h-6 fill-current"></i></a>
                        <a href="#" class="text-gray-400 hover:text-orange-400 transition duration-200" aria-label="Twitter"><i data-lucide="twitter" class="w-6 h-6"></i></a>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-700 text-center">
                <p class="text-sm text-gray-500">&copy; 2025 Aneka Cipta Rasa. Hak Cipta Dilindungi.</p>
            </div>
        </div>
    </footer>


    <script>
        // --- DATA PRODUK & VARIABEL GLOBAL ---
        const PRODUCTS = [
            { id: 1, name: "Kripik Singkong Gurih", category: "Makanan Ringan", price: 15000, image: "https://placehold.co/400x300/a7f3d0/065f46?text=Keripik+Singkong", description: "Keripik singkong renyah dengan bumbu tradisional yang gurih, diproses tanpa bahan pengawet. Cocok untuk teman santai dan oleh-oleh.", stock: 50 },
            { id: 2, name: "Nastar Keju Premium", category: "Kue Kering", price: 65000, image: "https://placehold.co/400x300/fecaca/991b1b?text=Nastar+Keju", description: "Kue nastar dengan isian nanas segar dan topping keju premium. Tekstur lembut dan meleleh di mulut! Dibuat dengan mentega asli.", stock: 30 },
            { id: 3, name: "Kerajinan Batik Tulis", category: "Kerajinan", price: 120000, image: "https://placehold.co/400x300/e0e7ff/3730a3?text=Batik+Tulis", description: "Kain batik tulis asli dari perajin lokal, motif kontemporer yang unik dan elegan. Ukuran 2m x 1m. Sempurna untuk koleksi atau busana.", stock: 10 },
            { id: 4, name: "Brownies Panggang Cokelat", category: "Kue Kering", price: 45000, image: "https://placehold.co/400x300/fbcfe8/be185d?text=Brownies", description: "Brownies panggang dengan rasa cokelat pekat dan tekstur fudgy. Dibuat dengan cokelat berkualitas tinggi dan minim gula.", stock: 40 },
            { id: 5, name: "Kerupuk Udang Special", category: "Makanan Ringan", price: 25000, image: "https://placehold.co/400x300/a7f3d0/065f46?text=Kerupuk+Udang", description: "Kerupuk udang mentah siap goreng, rasa udang otentik dan aroma yang menggugah selera. Produk andalan keluarga.", stock: 60 },
            { id: 6, name: "Souvenir Kayu Ukir Mini", category: "Kerajinan", price: 80000, image: "https://placehold.co/400x300/e0e7ff/3730a3?text=Souvenir+Kayu", description: "Souvenir berbentuk miniatur unik, diukir tangan dari kayu jati belanda. Cocok untuk hadiah atau dekorasi meja.", stock: 25 },
        ];
        
        let CART = []; // Cart data will be initialized and stored in localStorage/Firestore
        let testimonialIndex = 0;
        let testimonialsData = []; // To store fetched testimonials
        let cartUnsubscribe = null;
        let testimonialsUnsubscribe = null;

        // --- FIREBASE CART AND DATA INITIALIZATION ---
        window.initCartAndData = () => {
            const userIdDisplay = document.getElementById('current-user-id');
            const footerUserIdDisplay = document.getElementById('footer-user-id');
            if (window.userId) {
                userIdDisplay.textContent = window.userId;
                footerUserIdDisplay.textContent = window.userId.substring(0, 8) + '...';
                
                // 1. Initialize Cart Listener (Private Data)
                setupCartListener();
                
                // 2. Initialize Testimonial Listener (Public Data)
                testimonialsUnsubscribe = window.fetchTestimonials();

            } else {
                // Fallback (e.g., if Firebase is not configured)
                CART = JSON.parse(localStorage.getItem('homeCraftCart')) || [];
                renderCart();
                renderProducts(); 
                document.getElementById('current-user-id').textContent = 'Mode Lokal';
                document.getElementById('footer-user-id').textContent = 'Mode Lokal';
                renderTestimonials(getMockTestimonials());
            }

            // Start AOS and Render initial catalog filters
            AOS.init({ duration: 800, once: true });
            renderCategoryFilters();
            // Ensure initial view is home
            showView('home'); 
            
            // Initial call to render products
            renderProducts();
        };

        const setupCartListener = () => {
             if (!window.db || !window.userId || cartUnsubscribe) {
                // Prevent duplicate listeners
                return;
            }
            try {
                const cartRef = collection(window.db, `artifacts/${window.appId}/users/${window.userId}/cart_items`);
                const q = query(cartRef);
                
                cartUnsubscribe = onSnapshot(q, (querySnapshot) => {
                    CART = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        CART.push({ id: doc.id, ...data });
                    });
                    console.log("Cart updated from Firestore:", CART);
                    renderCart();
                }, (error) => {
                    console.error("Error fetching cart: ", error);
                    // Fallback to local storage if Firestore fails
                    CART = JSON.parse(localStorage.getItem('homeCraftCart')) || [];
                    renderCart();
                });
            } catch (e) {
                console.error("Error setting up cart listener:", e);
                 // Fallback to local storage
                CART = JSON.parse(localStorage.getItem('homeCraftCart')) || [];
                renderCart();
            }
        };


        // --- VIEW MANAGEMENT (SPA) ---
        function showView(viewId, productId = null) {
            const views = document.querySelectorAll('.view-section');
            views.forEach(view => {
                view.classList.add('hidden');
                view.classList.remove('animate-fade-in');
            });

            const activeView = document.getElementById(`view-${viewId}`);
            if (activeView) {
                activeView.classList.remove('hidden');
                // Optional: Add a simple transition class
                activeView.classList.add('animate-fade-in');
                window.scrollTo(0, 0); // Scroll to top on view change

                if (viewId === 'products') {
                    renderProducts();
                } else if (viewId === 'detail' && productId) {
                    renderProductDetail(productId);
                } else if (viewId === 'cart') {
                    renderCart();
                } else if (viewId === 'about') {
                    // Reset testimonial carousel
                    testimonialIndex = 0;
                    updateTestimonialCarousel();
                }
            }
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const button = document.getElementById('mobile-menu-button');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            // Toggle icon (optional, using CSS classes for simplicity)
            const openIcon = button.querySelector('svg.block');
            const closeIcon = button.querySelector('svg.hidden');
            if (menu.style.display === 'block') {
                openIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
            } else {
                openIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }
        }
        
        // --- UTILITY FUNCTIONS ---
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }
        
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let bgColor = 'bg-green-500';
            let icon = 'check-circle';
            
            if (type === 'error') {
                bgColor = 'bg-red-500';
                icon = 'x-circle';
            } else if (type === 'info') {
                bgColor = 'bg-blue-500';
                icon = 'info';
            } else if (type === 'warning') {
                bgColor = 'bg-yellow-500';
                icon = 'alert-triangle';
            }
            
            toast.className = `p-4 ${bgColor} text-white rounded-xl shadow-lg flex items-center transition-opacity duration-300 transform translate-x-full opacity-0`;
            toast.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5 mr-3"></i>
                <span class="font-medium">${message}</span>
            `;
            
            container.appendChild(toast);
            lucide.createIcons(); // Re-render Lucide icons
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
            }, 10);

            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- PRODUCT CATALOG & FILTER LOGIC ---
        
        function getCategories() {
            const categories = new Set(PRODUCTS.map(p => p.category));
            return ['Semua Kategori', ...Array.from(categories)];
        }
        
        function renderCategoryFilters() {
            const filterSelect = document.getElementById('category-filter');
            const categories = getCategories();
            
            filterSelect.innerHTML = categories.map(cat => 
                `<option value="${cat === 'Semua Kategori' ? 'all' : cat}">${cat}</option>`
            ).join('');
        }

        function renderProducts() {
            const listContainer = document.getElementById('product-list');
            const searchValue = document.getElementById('product-search').value.toLowerCase();
            const categoryValue = document.getElementById('category-filter').value;

            const filteredProducts = PRODUCTS.filter(product => {
                const searchMatch = product.name.toLowerCase().includes(searchValue) || 
                                    product.description.toLowerCase().includes(searchValue);
                const categoryMatch = categoryValue === 'all' || product.category === categoryValue;
                return searchMatch && categoryMatch;
            });
            
            if (filteredProducts.length === 0) {
                listContainer.innerHTML = `<p class="col-span-full text-center text-xl text-gray-500 py-10">
                    Maaf, produk yang Anda cari tidak ditemukan.
                </p>`;
                return;
            }

            listContainer.innerHTML = filteredProducts.map((product, index) => `
                <div class="bg-white rounded-xl overflow-hidden card-shadow" data-aos="fade-up" data-aos-delay="${index % 4 * 100}">
                    <!-- Image -->
                    <img src="${product.image}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e7ff/3730a3?text=Gambar+Tidak+Tersedia';"
                        class="w-full h-48 object-cover">
                    
                    <div class="p-5">
                        <!-- Category Badge -->
                        <span class="inline-block bg-green-100 text-green-800 text-xs font-medium px-3 py-1 rounded-full mb-2">
                            ${product.category}
                        </span>
                        
                        <!-- Name & Price -->
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${product.name}</h3>
                        <p class="text-2xl font-extrabold text-orange-600 mb-4">${formatRupiah(product.price)}</p>
                        
                        <!-- Actions -->
                        <div class="flex flex-col space-y-2">
                            <button onclick="showView('detail', ${product.id})"
                                class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded-lg transition duration-300 flex items-center justify-center">
                                <i data-lucide="eye" class="w-5 h-5 mr-2"></i> Lihat Detail
                            </button>
                            <button onclick="handleAddToCart(${product.id}, 1)"
                                class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-lg transition duration-300 flex items-center justify-center">
                                <i data-lucide="shopping-cart" class="w-5 h-5 mr-2"></i> Tambah ke Keranjang
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderProductDetail(id) {
            const product = PRODUCTS.find(p => p.id === id);
            const container = document.getElementById('product-detail-content');
            
            if (!product) {
                container.innerHTML = '<p class="text-center text-red-500">Produk tidak ditemukan.</p>';
                return;
            }

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Image Area -->
                    <div class="lg:sticky lg:top-20" data-aos="zoom-in">
                        <img src="${product.image}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e7ff/3730a3?text=Gambar+Tidak+Tersedia';"
                            class="w-full h-auto object-cover rounded-xl shadow-lg border border-green-200">
                    </div>

                    <!-- Details Area -->
                    <div data-aos="fade-left" data-aos-delay="200">
                        <span class="inline-block bg-green-100 text-green-800 text-sm font-medium px-4 py-1 rounded-full mb-3">${product.category}</span>
                        <h1 class="text-4xl font-extrabold text-green-900 mb-4">${product.name}</h1>
                        <p class="text-3xl font-extrabold text-orange-600 mb-6">${formatRupiah(product.price)}</p>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Deskripsi Produk</h3>
                        <p class="text-gray-600 mb-6 leading-relaxed">${product.description}</p>

                        <div class="flex items-center space-x-6 text-gray-600 mb-8">
                            <div class="flex items-center">
                                <i data-lucide="box" class="w-5 h-5 mr-2 text-green-500"></i>
                                <span>Stok Tersedia: <span class="font-bold text-green-700">${product.stock}</span></span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col space-y-3">
                            <button onclick="handleAddToCart(${product.id}, 1)"
                                class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-xl shadow-lg transition duration-300 flex items-center justify-center">
                                <i data-lucide="shopping-bag" class="w-6 h-6 mr-2"></i> Tambah ke Keranjang
                            </button>
                            <a href="https://wa.me/6281380637870?text=Halo,%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.name)}%20(ID:%20${product.id}).%20Bisakah%20saya%20memesan%20sekarang?" target="_blank"
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-xl shadow-lg transition duration-300 flex items-center justify-center">
                                <i data-lucide="whatsapp" class="w-6 h-6 mr-2 fill-white"></i> Beli Langsung via WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- CART LOGIC ---
        
        async function updateCartInFirestore(cartData) {
            if (!window.db || !window.userId) {
                console.warn("Firestore not available. Using localStorage.");
                localStorage.setItem('homeCraftCart', JSON.stringify(cartData));
                return;
            }

            // Sync all items at once to minimize writes, using product ID as doc ID
            try {
                // Fetch current docs to delete items not in new cart
                const cartRef = collection(window.db, `artifacts/${window.appId}/users/${window.userId}/cart_items`);
                const snapshot = await getDocs(cartRef);
                const currentDocIds = snapshot.docs.map(doc => doc.id);
                const newCartProductIds = cartData.map(item => String(item.productId));
                
                // Delete items no longer in cart
                for (const docId of currentDocIds) {
                    if (!newCartProductIds.includes(docId)) {
                        await deleteDoc(doc(cartRef, docId));
                    }
                }
                
                // Add or update items
                for (const item of cartData) {
                    const docId = String(item.productId);
                    const docRef = doc(cartRef, docId);
                    // Use item.productId as the unique identifier in Firestore
                    await setDoc(docRef, { 
                        productId: item.productId, 
                        quantity: item.quantity, 
                        timestamp: serverTimestamp() 
                    }, { merge: true });
                }
            } catch (error) {
                console.error("Error updating cart in Firestore:", error);
            }
        }
        
        async function handleAddToCart(productId, quantity) {
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) return;
            
            const existingItemIndex = CART.findIndex(item => item.productId === productId);

            if (existingItemIndex > -1) {
                CART[existingItemIndex].quantity += quantity;
            } else {
                CART.push({ productId: productId, quantity: quantity, price: product.price, name: product.name });
            }
            
            await updateCartInFirestore(CART);
            
            showToast(`Ditambahkan: ${quantity}x ${product.name}`, 'success');
        }

        async function updateCartQuantity(productId, newQuantity) {
            const index = CART.findIndex(item => item.productId === productId);
            if (index > -1) {
                newQuantity = parseInt(newQuantity);
                if (newQuantity > 0) {
                    CART[index].quantity = newQuantity;
                } else {
                    // Remove if quantity is 0
                    CART.splice(index, 1);
                }
                await updateCartInFirestore(CART);
            }
        }

        async function removeFromCart(productId) {
            CART = CART.filter(item => item.productId !== productId);
            await updateCartInFirestore(CART);
            showToast('Produk berhasil dihapus dari keranjang', 'info');
        }

        function renderCart() {
            const cartList = document.getElementById('cart-list');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountElement = document.getElementById('cart-count');
            const checkoutButton = document.getElementById('checkout-button');
            const emptyMessage = document.getElementById('empty-cart-message');

            if (CART.length === 0) {
                cartList.innerHTML = '<p class="text-center text-gray-500 py-10 bg-white rounded-xl card-shadow border border-green-100">Keranjang Anda kosong. Mari lihat-lihat produk!</p>';
                cartTotalElement.textContent = formatRupiah(0);
                cartCountElement.textContent = 0;
                checkoutButton.disabled = true;
                emptyMessage.classList.remove('hidden');
                return;
            }

            emptyMessage.classList.add('hidden');
            let total = 0;
            let totalItems = 0;

            cartList.innerHTML = CART.map(item => {
                const productInfo = PRODUCTS.find(p => p.id === item.productId) || { name: 'Produk Tidak Dikenal', price: item.price };
                const subtotal = productInfo.price * item.quantity;
                total += subtotal;
                totalItems += item.quantity;

                return `
                    <div class="flex items-center justify-between p-4 bg-white rounded-xl card-shadow border border-green-100" data-aos="fade-right">
                        <!-- Product Info -->
                        <div class="flex items-center flex-grow">
                            <img src="${productInfo.image}" alt="${productInfo.name}" class="w-16 h-16 object-cover rounded-lg mr-4 hidden sm:block">
                            <div class="flex-grow">
                                <h4 class="font-semibold text-gray-800">${productInfo.name}</h4>
                                <p class="text-sm text-gray-500">${formatRupiah(productInfo.price)} / pc</p>
                            </div>
                        </div>

                        <!-- Quantity Control -->
                        <div class="flex items-center space-x-2 mx-4 flex-shrink-0">
                            <button onclick="updateCartQuantity(${item.productId}, ${item.quantity - 1})" 
                                class="bg-green-100 text-green-800 p-1 rounded-full hover:bg-green-200 transition duration-200">
                                <i data-lucide="minus" class="w-4 h-4"></i>
                            </button>
                            <input type="number" value="${item.quantity}" min="1" 
                                onchange="updateCartQuantity(${item.productId}, this.value)"
                                class="w-12 text-center border border-green-300 rounded-lg text-gray-800">
                            <button onclick="updateCartQuantity(${item.productId}, ${item.quantity + 1})" 
                                class="bg-green-100 text-green-800 p-1 rounded-full hover:bg-green-200 transition duration-200">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                            </button>
                        </div>

                        <!-- Subtotal & Remove -->
                        <div class="flex items-center space-x-4 flex-shrink-0">
                            <span class="font-bold text-lg text-orange-600 w-24 text-right hidden sm:block">${formatRupiah(subtotal)}</span>
                            <button onclick="removeFromCart(${item.productId})" class="text-red-500 hover:text-red-700 transition duration-200" aria-label="Hapus">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
            cartTotalElement.textContent = formatRupiah(total);
            cartCountElement.textContent = totalItems;
            checkoutButton.disabled = false;
        }

        function generateWhatsAppMessage() {
            let message = "Halo, saya ingin memesan produk berikut:\n\n";
            let total = 0;

            CART.forEach(item => {
                const productInfo = PRODUCTS.find(p => p.id === item.productId) || { name: 'Produk Tidak Dikenal', price: item.price };
                const subtotal = productInfo.price * item.quantity;
                total += subtotal;
                message += `${item.quantity}x ${productInfo.name} (${formatRupiah(subtotal)})\n`;
            });

            message += `\nSubtotal: ${formatRupiah(total)}\n`;
            message += "\nMohon konfirmasi ketersediaan stok dan total biaya termasuk ongkos kirim. Terima kasih!";

            return encodeURIComponent(message);
        }

        function checkoutViaWhatsApp() {
            if (CART.length === 0) {
                showToast('Keranjang kosong, tidak bisa checkout.', 'warning');
                return;
            }
            const waNumber = '6281380637870';
            const message = generateWhatsAppMessage();
            const waLink = `https://wa.me/${waNumber}?text=${message}`;
            
            window.open(waLink, '_blank');
            showToast('Pesan WhatsApp telah dibuat!', 'success');
        }

        // --- CONTACT FORM LOGIC ---
        async function handleContactSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const name = form.name.value;
            const email = form.email.value;
            const message = form.message.value;
            
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Mengirim...';

            let success = false;
            
            if (window.saveContactMessage) {
                 success = await window.saveContactMessage(name, email, message);
            } else {
                // Mock submission for local mode
                console.log("CONTACT FORM SUBMISSION (MOCK):", { name, email, message });
                success = true;
            }
            
            submitButton.disabled = false;
            submitButton.textContent = 'Kirim Pesan';

            if (success) {
                showToast('Pesan Anda berhasil dikirim! Kami akan segera menghubungi Anda.', 'success');
                form.reset();
            } else {
                 showToast('Gagal mengirim pesan. Silakan coba lagi atau hubungi via WA.', 'error');
            }
        }
        
        // --- FAQ ACCORDION LOGIC ---
        function toggleFaq(button) {
            const content = button.nextElementSibling;
            const icon = button.querySelector('i');
            
            // Close all others
            document.querySelectorAll('.faq-content').forEach(item => {
                if (item !== content && !item.classList.contains('hidden')) {
                    item.classList.add('hidden');
                    item.previousElementSibling.querySelector('i').classList.remove('rotate-180');
                }
            });

            // Toggle current
            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        // --- TESTIMONIAL CAROUSEL LOGIC ---
        
        function getMockTestimonials() {
            return [
                { id: 1, name: "Rina, Jakarta", content: "Kripik singkongnya nagih banget, renyah dan bumbunya pas. Pengiriman cepat dan packaging rapi!" },
                { id: 2, name: "Bima, Bandung", content: "Batik tulisnya sangat cantik, ukiran kayunya juga detail. Produk lokal yang membanggakan!" },
                { id: 3, name: "Citra, Surabaya", content: "Nastar Kejunya premium, cocok untuk hantaran. Selalu repeat order dari sini." },
            ];
        }
        
        window.renderTestimonials = (testimonials) => {
            const container = document.getElementById('testimonial-container');
            if (!container) return;

            // Use mock data if fetched data is empty or null
            testimonialsData = (testimonials && testimonials.length > 0) ? testimonials : getMockTestimonials();
            
            container.innerHTML = testimonialsData.map(t => `
                <div class="w-full flex-shrink-0 text-center p-4">
                    <p class="italic text-gray-700 text-xl mb-4">"${t.content}"</p>
                    <p class="font-semibold text-green-800">- ${t.name}</p>
                </div>
            `).join('');
            
            // Initialize/Update carousel position
            testimonialIndex = 0;
            updateTestimonialCarousel();
        }

        function updateTestimonialCarousel() {
            const container = document.getElementById('testimonial-container');
            if (!container || testimonialsData.length === 0) return;
            
            // Calculate translate offset
            const offset = -testimonialIndex * 100;
            container.style.transform = `translateX(${offset}%)`;
        }

        function nextTestimonial() {
            if (testimonialsData.length === 0) return;
            testimonialIndex = (testimonialIndex + 1) % testimonialsData.length;
            updateTestimonialCarousel();
        }

        function prevTestimonial() {
            if (testimonialsData.length === 0) return;
            testimonialIndex = (testimonialIndex - 1 + testimonialsData.length) % testimonialsData.length;
            updateTestimonialCarousel();
        }

        // --- INITIALIZATION ---
        
        // This function will be called once Firebase auth is ready (see top script block)
        // or immediately if Firebase config is not present.
        // It ensures all dynamic rendering is done after the environment is set up.
        // window.initCartAndData(); 
        
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            // Fallback for immediate initialization if the Firebase block doesn't run fast enough
            if (!window.db) {
                 window.initCartAndData();
            }
        });
    </script>
</body>
</html>

